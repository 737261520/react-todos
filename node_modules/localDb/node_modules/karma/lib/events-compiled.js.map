{"version":3,"sources":["events.js"],"names":[],"mappings":"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","file":"events-compiled.js","sourcesContent":["var events = require('events');\nvar util = require('util');\nvar Q = require('q');\n\nvar helper = require('./helper');\n\n\nvar bindAllEvents = function(object, context) {\n  context = context || this;\n\n  var bindMethod = function(method) {\n    context.on(helper.camelToSnake(method.substr(2)), function() {\n      var args = Array.prototype.slice.call(arguments, 0);\n      args.push(context);\n      object[method].apply(object, args);\n    });\n  };\n\n  for (var method in object) {\n    if (helper.isFunction(object[method]) && method.substr(0, 2) === 'on') {\n      bindMethod(method);\n    }\n  }\n};\n\n\nvar bufferEvents = function(emitter, eventsToBuffer) {\n  var listeners = [];\n  var eventsToReply = [];\n  var genericListener = function() {\n    eventsToReply.push(Array.prototype.slice.call(arguments));\n  };\n\n  eventsToBuffer.forEach(function(eventName) {\n    var listener = genericListener.bind(null, eventName);\n    listeners.push(listener);\n    emitter.on(eventName, listener);\n  });\n\n  return function() {\n    if (!eventsToReply) {\n      return;\n    }\n\n    // remove all buffering listeners\n    listeners.forEach(function(listener, i) {\n      emitter.removeListener(eventsToBuffer[i], listener);\n    });\n\n    // reply\n    eventsToReply.forEach(function(args) {\n      events.EventEmitter.prototype.emit.apply(emitter, args);\n    });\n\n    // free-up\n    listeners = eventsToReply = null;\n  };\n};\n\n\n// TODO(vojta): log.debug all events\nvar EventEmitter = function() {\n  this.bind = bindAllEvents;\n\n  this.emitAsync = function(name) {\n    // TODO(vojta): allow passing args\n    // TODO(vojta): ignore/throw if listener call done() multiple times\n    var pending = this.listeners(name).length;\n    var deferred = Q.defer();\n    var done = function() {\n      if (!--pending) {\n        deferred.resolve();\n      }\n    };\n\n    this.emit(name, done);\n\n    if (!pending) {\n      deferred.resolve();\n    }\n\n    return deferred.promise;\n  };\n};\n\nutil.inherits(EventEmitter, events.EventEmitter);\n\n\n// PUBLISH\nexports.EventEmitter = EventEmitter;\nexports.bindAll = bindAllEvents;\nexports.bufferEvents = bufferEvents;\n"]}