{"version":3,"sources":["base.js"],"names":[],"mappings":"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","file":"base-compiled.js","sourcesContent":["var KarmaEventEmitter = require('../events').EventEmitter;\nvar EventEmitter = require('events').EventEmitter;\nvar q = require('q');\nvar log = require('../logger').create('launcher');\n\nvar BEING_CAPTURED = 1;\nvar CAPTURED = 2;\nvar BEING_KILLED = 3;\nvar FINISHED = 4;\nvar RESTARTING = 5;\nvar BEING_FORCE_KILLED = 6;\n\n\n/**\n * Base launcher that any custom launcher extends.\n */\nvar BaseLauncher = function(id, emitter) {\n  if (this.start) {\n    return;\n  }\n\n  // TODO(vojta): figure out how to do inheritance with DI\n  Object.keys(EventEmitter.prototype).forEach(function(method) {\n    this[method] = EventEmitter.prototype[method];\n  }, this);\n  KarmaEventEmitter.call(this);\n\n  this.id = id;\n  this.state = null;\n  this.error = null;\n\n  var self = this;\n  var killingPromise;\n  var previousUrl;\n\n  this.start = function(url) {\n    previousUrl = url;\n\n    this.error = null;\n    this.state = BEING_CAPTURED;\n    this.emit('start', url + '?id=' + this.id);\n  };\n\n  this.kill = function() {\n    // Already killed, or being killed.\n    if (killingPromise) {\n      return killingPromise;\n    }\n\n    killingPromise = this.emitAsync('kill').then(function() {\n      self.state = FINISHED;\n    });\n\n    this.state = BEING_KILLED;\n\n    return killingPromise;\n  };\n\n  this.forceKill = function() {\n    this.kill();\n    this.state = BEING_FORCE_KILLED;\n\n    return killingPromise;\n  };\n\n  this.restart = function() {\n    if (this.state === BEING_FORCE_KILLED) {\n      return;\n    }\n\n    if (!killingPromise) {\n      killingPromise = this.emitAsync('kill');\n    }\n\n    killingPromise.then(function() {\n      if (self.state === BEING_FORCE_KILLED) {\n        self.state = FINISHED;\n      } else {\n        killingPromise = null;\n        log.debug('Restarting %s', self.name);\n        self.start(previousUrl);\n      }\n    });\n\n    self.state = RESTARTING;\n  };\n\n  this.markCaptured = function() {\n    if (this.state === BEING_CAPTURED) {\n      this.state = CAPTURED;\n    }\n  };\n\n  this.isCaptured = function() {\n    return this.state === CAPTURED;\n  };\n\n  this.toString = function() {\n    return this.name;\n  };\n\n  this._done = function(error) {\n    killingPromise = killingPromise || q();\n\n    this.error = this.error || error;\n    this.emit('done');\n\n    if (this.error && this.state !== BEING_FORCE_KILLED && this.state !== RESTARTING) {\n      emitter.emit('browser_process_failure', this);\n    }\n\n    this.state = FINISHED;\n  };\n\n  this.STATE_BEING_CAPTURED = BEING_CAPTURED;\n  this.STATE_CAPTURED = CAPTURED;\n  this.STATE_BEING_KILLED = BEING_KILLED;\n  this.STATE_FINISHED = FINISHED;\n  this.STATE_RESTARTING = RESTARTING;\n  this.STATE_BEING_FORCE_KILLED = BEING_FORCE_KILLED;\n};\n\nBaseLauncher.decoratorFactory = function(id, emitter) {\n  return function(launcher) {\n    BaseLauncher.call(launcher, id, emitter);\n  };\n};\n\n\nmodule.exports = BaseLauncher;\n"]}