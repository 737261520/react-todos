{"version":3,"sources":["reporter.js"],"names":[],"mappings":"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","file":"reporter-compiled.js","sourcesContent":["var util = require('util');\nvar log = require('./logger').create('reporter');\nvar MultiReporter = require('./reporters/multi');\nvar baseReporterDecoratorFactory = require('./reporters/base').decoratorFactory;\nvar SourceMapConsumer = require('source-map').SourceMapConsumer;\n\nvar createErrorFormatter = function(basePath, emitter, SourceMapConsumer) {\n  var lastServedFiles = [];\n\n  emitter.on('file_list_modified', function(filesPromise) {\n    filesPromise.then(function(files) {\n      lastServedFiles = files.served;\n    });\n  });\n\n  var findFile = function(path) {\n    for (var i = 0; i < lastServedFiles.length; i++) {\n      if (lastServedFiles[i].path === path) {\n        return lastServedFiles[i];\n      }\n    }\n    return null;\n  };\n\n  var URL_REGEXP = new RegExp('http:\\\\/\\\\/[^\\\\/]*\\\\/' +\n                              '(base|absolute)' + // prefix\n                              '((?:[A-z]\\\\:)?[^\\\\?\\\\s\\\\:]*)' + // path\n                              '(\\\\?\\\\w*)?' +      // sha\n                              '(\\\\:(\\\\d+))?' +    // line\n                              '(\\\\:(\\\\d+))?' +    // column\n                              '', 'g');\n\n  return function(msg, indentation) {\n    // remove domain and timestamp from source files\n    // and resolve base path / absolute path urls into absolute path\n    msg = (msg || '').replace(URL_REGEXP, function(_, prefix, path, __, ___, line, ____, column) {\n\n      if (prefix === 'base') {\n        path = basePath + path;\n      }\n\n      var file = findFile(path);\n\n      if (file && file.sourceMap) {\n        line = parseInt(line || '0', 10);\n        column = parseInt(column || '0', 10);\n\n        var smc = new SourceMapConsumer(file.sourceMap);\n        try {\n          var original = smc.originalPositionFor({line: line, column: column});\n\n          return util.format('%s:%d:%d <- %s:%d:%d', path, line, column, original.source,\n            original.line, original.column);\n        } catch (e) {\n          log.warn('SourceMap position not found for trace: %s', msg);\n          // Fall back to non-source-mapped formatting.\n        }\n      }\n\n      return path + (line ? ':' + line : '') + (column ? ':' + column : '');\n    });\n\n    // indent every line\n    if (indentation) {\n      msg = indentation + msg.replace(/\\n/g, '\\n' + indentation);\n    }\n\n    return msg + '\\n';\n  };\n};\n\n\nvar createReporters = function(names, config, emitter, injector) {\n  var errorFormatter = createErrorFormatter(config.basePath, emitter, SourceMapConsumer);\n  var reporters = [];\n\n  // TODO(vojta): instantiate all reporters through DI\n  names.forEach(function(name) {\n    if (['dots', 'progress'].indexOf(name) !== -1) {\n      var Cls = require('./reporters/' + name + (config.colors ? '_color' : ''));\n      return reporters.push(new Cls(errorFormatter, config.reportSlowerThan));\n    }\n\n    var locals = {\n      baseReporterDecorator: ['factory', baseReporterDecoratorFactory],\n      formatError: ['value', errorFormatter]\n    };\n\n    try {\n      reporters.push(injector.createChild([locals], ['reporter:' + name]).get('reporter:' + name));\n    } catch (e) {\n      if (e.message.indexOf('No provider for \"reporter:' + name + '\"') !== -1) {\n        log.warn('Can not load \"%s\", it is not registered!\\n  ' +\n                 'Perhaps you are missing some plugin?', name);\n      } else {\n        log.warn('Can not load \"%s\"!\\n  ' + e.stack, name);\n      }\n    }\n  });\n\n  // bind all reporters\n  reporters.forEach(function(reporter) {\n    emitter.bind(reporter);\n  });\n\n  return new MultiReporter(reporters);\n};\n\ncreateReporters.$inject = ['config.reporters', 'config', 'emitter', 'injector'];\n\n\n// PUBLISH\nexports.createReporters = createReporters;\n"]}